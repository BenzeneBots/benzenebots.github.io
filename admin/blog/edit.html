<!DOCTYPE html>
<html>

<head>
    <title>Admin Panel</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
            href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&family=Oswald&family=Roboto:wght@400;700&display=swap"
            rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="/style.css">

    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script src="https://cdn.tiny.cloud/1/m0nda9niinb7ioc5ghl0ywb2z99uma0r8umbjafpd9xdyvo0/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>

</head>

<body>
<nav>
    <div class="nav-wrapper black" id="nav">
    </div>
</nav>

<ul class="sidenav grey darken-4" id="mobile-nav">
</ul>

<div id="linkmodal" class="modal grey darken-4">
    <div class="modal-content">
        <h4>Insert Link</h4>
        <div class="input-field row">
            <input id="insert-link-display" name="insert-link-display" type="text">
            <label for="insert-link-display">Link text</label>
        </div>
        <div class="input-field row">
            <input id="insert-link" name="insert-link" type="url">
            <label for="insert-link">URL</label>
        </div>
    </div>
    <div class="modal-footer grey darken-3">
        <a href="#!" class="modal-close btn red darken-3">Cancel</a>
        <a href="#!" class="modal-close btn red darken-3" id="insert-link-submit">Insert</a>
    </div>
</div>

<div id="imagemodal" class="modal grey darken-4">
    <div class="modal-content">
        <h4>Insert Image</h4>
        <div class="input-field row">
            <input id="insert-image" name="insert-image" type="file" accept="png,jpg,gif">
            <label for="insert-image">Image</label>
        </div>
    </div>
    <div class="modal-footer grey darken-3">
        <a href="#!" class="modal-close btn red darken-3">Cancel</a>
        <a href="#!" class="modal-close btn red darken-3" id="insert-image-submit">Insert</a>
    </div>
</div>

<div id="deletemodal" class="modal grey darken-4">
    <div class="modal-content">
        <p>Are you sure you want to delete this draft?</p>
        <div class="row">
            <a href="#!" class="modal-close btn red darken-3">Cancel</a>
            <a href="#!" class="modal-close btn grey darken-3" id="delete-submit">Delete</a>
        </div>
    </div>
</div>

<main>
    <div class="container">
        <div class="row" style="margin-top: 20px;">
            <a href="./" class="btn red darken-3"><span class="material-icons">arrow_back</span> Back</a>
            <a href="#" class="btn red darken-3" id="save"><span class="material-icons">save</span> Publish</a>
            <a href="#" class="btn red darken-3" id="delete"><span class="material-icons">delete</span> Delete draft</a>
        </div>
        <div class="row input-field">
            <input name="title" id="title" type="text">
            <label for="title">Title</label>
        </div>
    </div>
    <div class="grey darken-3" style="padding: 20px 0;">
        <div class="container">
            <div class="row">
                <div class="col s12 l6">
                    <textarea>
                        Welcome to TinyMCE!
                      </textarea>
                </div>
                <div class="col s12 l6">
                    <div class="post preview grey darken-4">
                        <h3>
                            <a href="#" id="title-preview"></a>
                        </h3>
                        <div class="post-published-date" id="date"></div>
                        <div class="post-body" id="preview"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script src="/admin/auth.js"></script>
<script src="https://momentjs.com/downloads/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js" type="text/javascript" charset="utf-8">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-twilight.min.js" type="text/javascript"
        charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-markdown.min.js" type="text/javascript"
        charset="utf-8"></script>


<script>

    tinyMCE.remove('textarea')
    tinymce.init({
        selector: 'textarea',
        plugins: [
            'advlist autolink lists link image charmap print preview anchor',
            'searchreplace visualblocks code fullscreen',
            'insertdatetime media table paste imagetools wordcount',
            'codesample emoticons media wordcount'
        ],
        toolbar: 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media| emoticons codesample wordcount ',
        editor: "restore_draft",
        toolbar_mode: 'floating',
        automatic_uploads: true,
        image_title: true,
        file_picker_types: 'image',
        file_picker_callback: function (cb, value, meta) {
            var input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');

            input.onchange = function () {
                var file = this.files[0];

                var reader = new FileReader();
                reader.onload = async function () {
                    const formData = new FormData()
                    formData.append('image', file)

                    let data = await fetch('https://api.benzenebots.com/store/upload', {
                        method: 'POST',
                        "headers": {
                            "password": "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8",
                            "id": "a34de56a-bb3a-483a-8d96-e95f885b3396",
                        },
                        body: formData
                    })
                    let json = await data.json();

                    cb("https://api.benzenebots.com/"+json.id, { title: file.name });
                };

//
                reader.readAsDataURL(file);
            };

            input.click();
        },
        branding: false,
        skin: "oxide-dark",
        icons: "thin",
        content_css: "dark",
    });
</script>
<script>
    tinymce.on( 'addeditor', e => {


        setInterval(function (inst) {
            document.getElementById('preview').innerHTML = tinymce.activeEditor.getContent()
        }, 100);
    }, true );
</script>

<script>
    const POST_ID = window.location.toString().split('id=')[1];

    if (POST_ID) document.getElementById('delete').href += POST_ID;

    window.addEventListener('auth', (evt) => {
        if (!auth) {
            window.location.href = "/admin/login.html?redirect=" + encodeURI(window.location);
        }
    });
    runAuth();
</script>
</body>

</html>
