const login=async(e,t)=>{let n=await new Promise(((t,n)=>crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e)).then((e=>{t(Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join(""))}))));fetch(API_ROOT+"/user/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}).then((e=>e.json())).then((e=>{e.user?(localStorage.setItem("id",e.user.id),localStorage.setItem("password",e.user.password),window.location.href=REDIRECT||"/admin/"):(document.getElementById("login-error").innerText=e.error,setInterval((()=>{document.getElementById("login-error").innerText=" "}),3e3))})).catch((e=>{M.toast({text:e.message})}))},handleFormSubmit=()=>{login(document.forms[0].elements[1].value,document.forms[0].elements[0].value)},addSubmitListener=()=>{document.forms[0].addEventListener("submit",(e=>{e.preventDefault()}))};addSubmitListener(),setTimeout(addSubmitListener,1e3),setTimeout(addSubmitListener,3e3);const REDIRECT=window.location.toString().split("redirect=")[1];window.addEventListener("auth",(()=>{auth&&(window.location.href=REDIRECT||"/admin/")})),runAuth();