let album={id:"",name:"",weight:0,images:[]},dropzone=document.getElementById("drop-area"),uploading=!1;const uploadFile=async e=>{let a=new FormData;return a.append("image",e),await fetch(API_ROOT+"/store/upload",{method:"POST",body:a,headers:{id:auth.id,password:auth.password}}).then((e=>e.json()))},dropHandler=async e=>{e.preventDefault(),uploading=!0,M.toast({html:"Uploading... Please wait"});let a=[];for(let t of e.dataTransfer.files)a.push(new Promise(((e,a)=>{uploadFile(t).then((a=>{fetch(API_ROOT+"/gallery/"+album.id+"/add/"+a.id,{method:"POST",headers:{id:auth.id,password:auth.password}}).then((a=>e()))}))})));Promise.all(a).then((()=>{getAlbum(album.id),M.toast({html:"Done!"}),uploading=!1}))};let timeout;const dragOverHandler=e=>{document.getElementById("drop-area").classList.add("highlight"),clearTimeout(timeout),timeout=setTimeout((()=>document.getElementById("drop-area").classList.remove("highlight")),100),e.preventDefault()},getAlbum=async e=>{album=(await fetch(API_ROOT+"/gallery/"+e).then((e=>e.json()))).album};window.addEventListener("beforeunload",(function(e){if(uploading){var a="Images are still uploading, if you leave now your changes will not be saved";return(e||window.event).returnValue=a,a}}));